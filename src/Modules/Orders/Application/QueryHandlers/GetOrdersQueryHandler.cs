using Microsoft.EntityFrameworkCore;
using Orders.Contracts.DTOs;
using Orders.Infrastructure.Data;

namespace Orders.Application.QueryHandlers;

public sealed class GetOrdersQueryHandler(OrdersDbContext db) {
    public async Task<List<OrderDto>> Handle(CancellationToken token = default) {
        return await db.Orders
            .AsNoTracking()
            .Select(o => new OrderDto(
                o.Id,
                o.CustomerId,
                o.Lines.Sum(l => l.Quantity * l.UnitPrice)))
            .ToListAsync(token);
    }
}
